<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">	<!--ставим кодировку чтобы не было краоказябров-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">     <!--задаем начальные рахмеры-->
    <title>NAEbank</title>	<!--название вкладки-->
    <link rel="stylesheet" href="styles.css">	<!--подключаем все файлы с кодом-->
    <script src="script.js"></script>
    <script src="parseQRCode.js"></script>
    <script src="html5-qrcode.min.js"></script>
	<script src="generate-number.js"></script>

	<!-- тут мы подрубаем шрифты чтоб было по красоте -->
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Экран 0: полноэкранная заставка -->
    <div id="screen0" class="screen active">	<!--тег active здесь обязатеен чтобы мы видели картинку а не белую  пустоту-->
        <img src="bg.jpg" id="splashImage" alt="Стартовое изображение">
    </div>

    <!-- Экран 1: сканер -->
    <div id="screen1" class="screen">
        <div id="scanner-container" style="position: relative;">
            <div id="qr-reader"></div>
        </div>
    </div>

    <!-- Экран 2: результат -->
    <div id="TULPARsuccess" class="screen">
		<img src="history.jpg" class="TULPARsuccess-bg">
	    <div class="history-box">
			<img src="success.png" alt="Успешно" class="success-image"> <!--фон с зеленой галочкой-->
			<div class="dotted-line">	<!--пунктирный разделитель-->
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			</div>

			<table class="custom-table">
			  <tbody>
				<tr><td>Имя получателя</td><td>ОПЛАТА ПО ЕДИНОМУ QR (КЭШАУТ) МПЦ</td></tr>
				<tr>
				  <td style="white-space: normal;">Оплачено со счета</td>
				  <td class="billnum" style="white-space: nowrap; width: 1%;"></td>	<!--небольшие извращения чтобы текст влезал в одну строку-->
				</tr>

				<tr><td>Дата операции</td><td class="datetime"></td></tr>
				<tr><td>Номер квитанции</td><td class="receipt"></td></tr>
				<tr><td>Поставщик услуги</td><td>qr.tulpar.kg</td></tr>
			  </tbody>
			</table>
			<div class="dotted-line">
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			</div>
			<p class="final">Оплата услуг. Получатель: Оплата по QR Госуслуги. <span id=auto></span>/TULPAR/17.00 <span class="hexid"></span> Сумма 17.00 KGS</p>	
		</div>
    </div>
	
	<div id="odengi" class="screen">
	<img src="history.jpg" class="TULPARsuccess-bg">
	    <div class="history-box">
			<img src="success.png" alt="Успешно" class="success-image"> <!--фон с зеленой галочкой-->
			<div class="dotted-line">	<!--пунктирный разделитель-->
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			</div>

			<div class=table-container>
			
			<table class="custom-table">
			  <tbody>
				<tr><td>Имя получателя</td><td>ОПЛАТА ПО ЕДИНОМУ QR (КЭШАУТ) МПЦ</td></tr>
				<tr>
				  <td style="white-space: normal;">Оплачено со счета</td>
				  <td class="billnum" style="white-space: nowrap; width: 1%;"></td>
				</tr>

				<tr><td>Дата операции</td><td class="datetime"></td></tr>
				<tr><td>Номер квитанции</td><td class="receipt"></td></tr>
				<tr><td>Поставщик услуги</td><td class="postavshik_2"></td></tr>
				<tr><td>Реквизит</td><td class="rekvizit_2"></td></tr>
				<tr><td>Комментарий</td><td class="comment_2"></td></tr>
				<tr><td>Получатель</td><td class="poluchatel_2"></td></tr>
				<tr><td>Идентификатор транзакции</td><td class="ID_2"></td></tr>
			  </tbody>
			</table>
			</div>
			
			<div class="dotted-line">
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			</div>
			<p class="final">Оплата услуг. Получатель: Перевод по QR. 
			<span class="rekv_1"></span>/<span class="usl_1"></span>/<span class="amount"></span> <span class="hexid"></span> 
			Сумма <span class="amountAgain"></span> KGS</p>	
		</div>
    </div>
	
	<div id="simbank" class="screen">
	<img src="history.jpg" class="TULPARsuccess-bg">
	    <div class="history-box">
			<img src="success.png" alt="Успешно" class="success-image"> <!--фон с зеленой галочкой-->
			<div class="dotted-line">	<!--пунктирный разделитель-->
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			</div>

			<div class=table-container>

			<table class="custom-table">
			  <tbody>
				<tr><td>Имя получателя</td><td>ОПЛАТА ПО ЕДИНОМУ QR (КЭШАУТ) МПЦ</td></tr>
				<tr>
				  <td style="white-space: normal;">Оплачено со счета</td>
				  <td class="billnum" style="white-space: nowrap; width: 1%;"></td>
				</tr>

				<tr><td>Дата операции</td><td class="datetime"></td></tr>
				<tr><td>Номер квитанции</td><td class="receipt"></td></tr>
				<tr><td>Поставщик услуги</td><td class="postavshik_2"></td></tr>
				<tr><td>Реквизит</td><td class="rekvizit_2"></td></tr>
				<tr><td>Получатель</td><td class="poluchatel_2"></td></tr>
				<tr><td>Идентификатор транзакции</td><td class="ID_2"></td></tr>
			  </tbody>
			</table>
			</div>
			
			<div class="dotted-line">
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			</div>
			<p class="final">Оплата услуг. Получатель: Перевод по QR. 
			<span class="rekv_1"></span>/Simbank/<span class="amount"></span> <span class="hexid"></span> 
			Сумма <span class="amountAgain"></span> KGS</p>	
		</div>
    </div>

	<div id="mbank" class="screen">
	<img src="history.jpg" class="TULPARsuccess-bg">
	    <div class="history-box">
			<img src="success.png" alt="Успешно" class="success-image"> <!--фон с зеленой галочкой-->
			<div class="dotted-line">	<!--пунктирный разделитель-->
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			</div>

			<div class=table-container>

			<table class="custom-table">
			  <tbody>
				<tr><td>Имя получателя</td><td class="usl_1"></td></tr>
				<tr>
				  <td style="white-space: normal;">Оплачено со счета</td>
				  <td class="billnum" style="white-space: nowrap; width: 1%;"></td>
				</tr>

				<tr><td>Дата операции</td><td class="datetime"></td></tr>
				<tr><td>Номер квитанции</td><td class="receipt"></td></tr>
			  </tbody>
			</table>
			</div>
			<div class="dotted-line">
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			  <div></div><div></div><div></div><div></div>
			</div>
			<p class="final">Перевод по номеру телефона qr.<br>
			<span class="rekv_1"></span>/
			<span class="usl_1"></span>
			/ /
			Сумма <span class="amountAgain"></span> KGS</p>	
		</div>
    </div>

	<div id="amountscreen" class="screen">
	<div class="payscreencontainer">
	  <div class="header">← Перевод по QR</div>

	  
	  <div class="value-box">
	    <div class="label">Реквизит</div>
		<div class="value rekv_1"></div>
	  </div>

	  <div class="value-box">
     	<div class="label">Услуга</div>

		<div class="value usl_1"></div>
	  </div>

	  <div class="input-box">
		<input type="number" class="amount-input" id="amount-input" placeholder="0 с" step="0.01" min="0" max="9999999999.99" inputmode="decimal">
		<div class="commission">Комиссия 0,00 <u>с</u></div>
	  </div>

	  <div class="card-box">
		<div class="card-left">
		  <div class="card-icon"><u><b>с</b></u></div>
		  <div class="card-number">4177 •••• •••• ••••
		  <div class="value">░▒░▒░▒</div>
		  </div>
		</div>
		<div class="card-right"><img src=card-mini.png style="object-fit:contain; width: 100%; height: 100%; border-radius:inherit;"></div>
	  </div>

	  <div class="pay-button" id="payBtn">Оплатить</div>
		
	<script>
	  const input = document.getElementById('amount-input');
	  const payBtn = document.getElementById('payBtn');

	  input.addEventListener('input', (e) => {
		const cursorPos = input.selectionStart;

		let rawValue = input.value;
		let value = rawValue.replace(',', '.'); // Разрешаем и запятую и точку

		// Удаляем все символы кроме цифр и точки
		value = value.replace(/[^0-9.]/g, '');

		// Оставляем только одну точку
		const parts = value.split('.');
		if (parts.length > 2) {
		  value = parts[0] + '.' + parts[1]; // отбрасываем лишние точки
		}

		let integerPart = parts[0] || '';
		let decimalPart = parts[1] || '';

		// Ограничения
		if (integerPart.length > 10) {
		  integerPart = integerPart.slice(0, 10);
		}
		if (decimalPart.length > 2) {
		  decimalPart = decimalPart.slice(0, 2);
		}

		// Собрать финальное значение
		let finalValue = integerPart;
		if (value.includes('.')) {
		  finalValue += '.' + decimalPart;
		}

		// Обновляем input без сброса курсора
		const prevLength = input.value.length;
		input.value = finalValue;
		const newLength = input.value.length;
		const diff = newLength - prevLength;
		input.setSelectionRange(cursorPos + diff, cursorPos + diff);

		// Обновляем кнопку
		if (finalValue) {
		  const floatValue = parseFloat(finalValue);
		  if (!isNaN(floatValue)) {
			const displayValue = floatValue.toFixed(2).replace('.', ',');
			payBtn.textContent = `Оплатить ${displayValue} с`;
			return;
		  }
		}

		payBtn.textContent = 'Оплатить';
	  });

	  // Заменяем запятую на точку при вводе
	  input.addEventListener('keydown', (e) => {
		if (e.key === ',') {
		  e.preventDefault();
		  const cursorPos = input.selectionStart;
		  const currentValue = input.value;
		  input.value = currentValue.slice(0, cursorPos) + '.' + currentValue.slice(cursorPos);
		  input.setSelectionRange(cursorPos + 1, cursorPos + 1);
		}
	  });
	</script>




	</div>
	</div>

	<!-- Экран вывода несовмесимого QR -->
	<div id="parseError" class="screen">
		<img src="history.jpg" class="error-bg">
		<div class="errMsgBox">
			QR не распознан
			<div class="ErrBtn" id="close">Закрыть</div>
		</div>
	</div>

</body>
</html>
